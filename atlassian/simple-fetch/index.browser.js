var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};const t=(e,t)=>({status:e,errorMessage:t}),r=(e,t)=>({status:e,response:t}),n=e=>"errorMessage"in e,o=(e,t)=>Math.abs(e+(t-e)*Math.random()),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=(e=14)=>Array.from({length:e},()=>s[Math.floor(Math.random()*s.length)]).join(""),a=3e3,u=new class{constructor(){this.tokens=new Map,this.hasToken=e=>this.tokens.has(e),this.createToken=(e=!1,t=a)=>{let r=i(),n={token:r,...e?{expires:Date.now()+t-200}:{}};return e&&setTimeout(()=>{this.tokens.delete(r)},t),this.tokens.set(r,n),n},this.clearAll=()=>this.tokens.clear()}},h=(e,t,r="GET")=>({path:e,handler:t,method:r}),l=(...e)=>t=>e.reverse().reduce((e,t)=>t(e),t),d=e=>{let{path:r,handler:n,method:o}=e;return h(r,e=>{var r,o;let{headers:s}=e,[i,a]=null!==(r=null==s||null===(o=s.Authorization)||void 0===o?void 0:o.toString().split(" "))&&void 0!==r?r:[];return"Bearer"===i&&a?u.hasToken(a)?n(e):t(401,"Access token is invalid"):t(400,"No access token was provided")},o)},c=new class{set(e){e<=0||(this.maxCount=e,this.currentCount=0,this.isRunning=!0)}tick(){return this.currentCount<this.maxCount?(this.currentCount+=1,!0):(this.maxCount=-1,this.currentCount=0,this.isRunning=!1,!1)}constructor(){this.maxCount=-1,this.currentCount=0,this.isRunning=!1}},p=h("/hello",()=>r(200,{hello:"world"})),f=(e,n=!1)=>h(e,({body:e,headers:o})=>{if(e&&void 0!==e.apiKey){if("4a8e3990b0e0559b77430f4ddb28a3cb"===e.apiKey){let e=n&&o&&"number"==typeof o.ttl?Math.abs(o.ttl):void 0;return r(200,u.createToken(n,e))}return t(401,"Provided API Key is invalid")}return t(400,"API Key was not provided")},"POST"),m=f("/api/auth"),T=f("/api/2/auth",!0),g=()=>{let e=i(5);return r(200,{id:e,authorId:`author-${i(3)}`,title:`This is blog ${e}`,summary:`A brief summary of blog ${e}`})},b=h("/api/blog/latest",g),v=h("/api/2/blog/latest",g),k=e=>new Promise((t,r)=>{setTimeout(()=>{n(e)?r(e):t(e)},o(25,100))});class w{constructor(e){this.routes={GET:{},POST:{},DELETE:{},PUT:{}},this.fetch=(e,r={})=>{let{method:n="GET"}=r;if(!["GET","POST","PUT","DELETE"].includes(n.toUpperCase()))return k(t(400,"Unsupported HTTP request method"));let o=n.toUpperCase(),s=this.getRoute(e,o);return k(s?s.handler(r):t(404,"The requested resource could not be found"))},e.forEach(e=>{this.routes[e.method][e.path]={...e}})}static makeFetch(e){return new w(e).fetch}getRoute(e,t){var r;return null===(r=this.routes)||void 0===r||null===(r=r[t])||void 0===r?void 0:r[e]}}const y=w.makeFetch([p,m,T,l(d)(b),l(d,((e=0)=>r=>{let{path:n,handler:o,method:s}=r;return h(n,r=>{let{headers:n}=r,s="number"==typeof(null==n?void 0:n.forceErrors)?n.forceErrors:e;return(s&&!c.isRunning&&c.set(s),c.isRunning&&c.tick())?t(500,"Something went wrong"):o(r)},s)})(1))(v)]);e.simpleFetch=y;