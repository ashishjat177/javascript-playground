var e=globalThis;let t=(e,t)=>({status:e,errorMessage:t}),r=(e,t)=>({status:e,response:t}),s=e=>"errorMessage"in e,o=(e,t)=>Math.abs(e+(t-e)*Math.random()),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=(e=14)=>Array.from({length:e},()=>n[Math.floor(Math.random()*n.length)]).join(""),a=3e3,h=new class{constructor(){this.tokens=new Map,this.hasToken=e=>this.tokens.has(e),this.createToken=(e=!1,t=a)=>{let r=i(),s={token:r,...e?{expires:Date.now()+t-200}:{}};return e&&setTimeout(()=>{this.tokens.delete(r)},t),this.tokens.set(r,s),s},this.clearAll=()=>this.tokens.clear()}},u=(e,t,r="GET")=>({path:e,handler:t,method:r}),l=(...e)=>t=>e.reverse().reduce((e,t)=>t(e),t),d=e=>{let{path:r,handler:s,method:o}=e;return u(r,e=>{var r,o;let{headers:n}=e,[i,a]=null!==(r=null==n||null===(o=n.Authorization)||void 0===o?void 0:o.toString().split(" "))&&void 0!==r?r:[];return"Bearer"===i&&a?h.hasToken(a)?s(e):t(401,"Access token is invalid"):t(400,"No access token was provided")},o)},c=new class{set(e){e<=0||(this.maxCount=e,this.currentCount=0,this.isRunning=!0)}tick(){return this.currentCount<this.maxCount?(this.currentCount+=1,!0):(this.maxCount=-1,this.currentCount=0,this.isRunning=!1,!1)}constructor(){this.maxCount=-1,this.currentCount=0,this.isRunning=!1}},p=u("/hello",()=>r(200,{hello:"world"})),m=(e,s=!1)=>u(e,({body:e,headers:o})=>{if(e&&void 0!==e.apiKey){if("4a8e3990b0e0559b77430f4ddb28a3cb"===e.apiKey){let e=s&&o&&"number"==typeof o.ttl?Math.abs(o.ttl):void 0;return r(200,h.createToken(s,e))}return t(401,"Provided API Key is invalid")}return t(400,"API Key was not provided")},"POST"),T=m("/api/auth"),g=m("/api/2/auth",!0),v=()=>{let e=i(5);return r(200,{id:e,authorId:`author-${i(3)}`,title:`This is blog ${e}`,summary:`A brief summary of blog ${e}`})},b=u("/api/blog/latest",v),f=u("/api/2/blog/latest",v),k=e=>new Promise((t,r)=>{setTimeout(()=>{s(e)?r(e):t(e)},o(25,100))});class E{constructor(e){this.routes={GET:{},POST:{},DELETE:{},PUT:{}},this.fetch=(e,r={})=>{let{method:s="GET"}=r;if(!["GET","POST","PUT","DELETE"].includes(s.toUpperCase()))return k(t(400,"Unsupported HTTP request method"));let o=s.toUpperCase(),n=this.getRoute(e,o);return k(n?n.handler(r):t(404,"The requested resource could not be found"))},e.forEach(e=>{this.routes[e.method][e.path]={...e}})}static makeFetch(e){return new E(e).fetch}getRoute(e,t){var r;return null===(r=this.routes)||void 0===r||null===(r=r[t])||void 0===r?void 0:r[e]}}let w=E.makeFetch([p,T,g,l(d)(b),l(d,((e=0)=>r=>{let{path:s,handler:o,method:n}=r;return u(s,r=>{let{headers:s}=r,n="number"==typeof(null==s?void 0:s.forceErrors)?s.forceErrors:e;return(n&&!c.isRunning&&c.set(n),c.isRunning&&c.tick())?t(500,"Something went wrong"):o(r)},n)})(1))(f)]);e.simpleFetch=w;export{w as simpleFetch};